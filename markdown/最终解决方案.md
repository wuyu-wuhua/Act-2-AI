# 最终解决方案

## 问题总结
您遇到的问题是数据类型不匹配：现有的 `act_credit_purchases` 表中的 `user_id` 字段是 `BIGINT` 类型，但新的 `act_users` 表的 `id` 字段是 `UUID` 类型，导致外键约束失败。

## 解决方案
使用 `clean_migration.sql` 脚本，它会：
1. **删除所有相关表**（包括有问题的表）
2. **重新创建所有表**（使用正确的UUID数据类型）
3. **确保所有外键约束一致**

## 操作步骤

### 1. 执行清理迁移脚本
```sql
-- 复制 clean_migration.sql 的全部内容到Supabase SQL编辑器并执行
```

### 2. 验证执行结果
执行后应该看到：
```
Clean migration completed successfully! All tables recreated with UUID user_id.
```

### 3. 测试积分系统
1. 使用新账号登录
2. 检查是否自动获得50积分
3. 查看个人中心页面

## 重要提醒

⚠️ **注意**：这个脚本会删除所有现有数据，包括：
- 所有用户数据
- 所有积分交易记录
- 所有积分包数据
- 所有其他相关数据

如果您有重要数据需要保留，请先备份。

## 如果仍有问题

如果执行后仍有问题，请：
1. 检查Supabase控制台是否有错误信息
2. 确认所有表都已正确创建
3. 验证用户ID字段类型是否为UUID

## 预期结果

执行成功后：
- ✅ 所有表都使用UUID类型的用户ID
- ✅ 外键约束正常工作
- ✅ 积分系统可以正常使用
- ✅ 新用户登录时自动获得50积分 